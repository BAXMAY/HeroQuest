{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the Deeds & Cheers application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL to the user's profile picture.",
          "format": "uri"
        },
        "totalPoints": {
          "type": "number",
          "description": "The total points accumulated by the user."
        },
        "braveCoins": {
          "type": "number",
          "description": "The total brave coins accumulated by the user."
        },
        "questsCompleted": {
          "type": "number",
          "description": "The total number of quests completed by the user."
        },
        "gender": {
            "type": "string",
            "description": "The gender of the user.",
            "enum": ["male", "female", "other"]
        },
        "birthday": {
            "type": "string",
            "description": "The user's birthday.",
            "format": "date"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "username"
      ]
    },
    "VolunteerWork": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VolunteerWork",
      "type": "object",
      "description": "Represents a volunteer work submission.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VolunteerWork entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N VolunteerWork)"
        },
        "description": {
          "type": "string",
          "description": "Description of the volunteer work performed."
        },
        "photos": {
          "type": "array",
          "description": "URLs to the photos of the volunteer work.",
          "items": {
            "type": "string"
          }
        },
        "submissionDate": {
          "type": "string",
          "description": "Date and time when the volunteer work was submitted.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of submission, such as pending, approved, or rejected.",
          "enum": ["draft", "pending", "approved", "rejected"]
        },
        "pointsAwarded": {
          "type": "number",
          "description": "The points awarded for the volunteer work."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "description",
        "submissionDate",
        "status"
      ]
    },
    "Achievement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Achievement",
      "description": "Represents an achievement unlocked by a user.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the achievement."
        },
        "name": {
          "type": "string",
          "description": "The name of the achievement."
        },
        "description": {
          "type": "string",
          "description": "A description of how the achievement was earned."
        },
        "icon": {
          "type": "string",
          "description": "An identifier for the icon representing the achievement."
        },
        "unlockedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time the achievement was unlocked."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "icon",
        "unlockedAt"
      ]
    },
     "RedeemedReward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RedeemedReward",
      "description": "Represents a reward redeemed by a user.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the redeemed reward."
        },
        "rewardId": {
            "type": "string",
            "description": "The ID of the original reward."
        },
        "name": {
            "type": "string",
            "description": "The name of the reward."
        },
        "cost": {
            "type": "number",
            "description": "The cost of the reward in Brave Coins."
        },
        "image": {
            "type": "string",
            "format": "uri",
            "description": "URL to the reward's image."
        },
        "redeemedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time the reward was redeemed."
        },
        "status": {
          "type": "string",
          "description": "The fulfillment status of the reward.",
          "enum": ["processing", "shipped", "delivered"]
        }
      },
      "required": ["id", "rewardId", "name", "cost", "image", "redeemedAt", "status"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data.  The path `/users/{userId}` enforces ownership; only the authenticated user with ID `userId` can access this document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, corresponding to their Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/volunteer_work/{workId}",
        "definition": {
          "entityName": "VolunteerWork",
          "schema": {
            "$ref": "#/backend/entities/VolunteerWork"
          },
          "description": "Stores volunteer work submissions for each user.  The `userProfileId` field matches the `userId` path parameter.  This enforces ownership, ensuring only the authenticated user with ID `userId` can manage volunteer work documents under their path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, corresponding to their Firebase Authentication UID."
            },
            {
              "name": "workId",
              "description": "The unique identifier of the volunteer work submission."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/achievements/{achievementId}",
        "definition": {
          "entityName": "Achievement",
          "schema": {
            "$ref": "#/backend/entities/Achievement"
          },
          "description": "Stores achievements unlocked by a user. Ownership is enforced by the path, allowing only the authenticated user to access their own achievements.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, corresponding to their Firebase Authentication UID."
            },
            {
              "name": "achievementId",
              "description": "The unique identifier for the achievement."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/redeemed_rewards/{redeemedRewardId}",
        "definition": {
          "entityName": "RedeemedReward",
          "schema": {
            "$ref": "#/backend/entities/RedeemedReward"
          },
          "description": "Stores rewards redeemed by a user. Ownership is enforced by the path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "redeemedRewardId",
              "description": "The unique identifier for the redeemed reward record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support user profiles and volunteer work submissions for the Deeds & Cheers application, prioritizing security, scalability, and debuggability, especially regarding authorization. \n\n**Authorization Independence:** The structure avoids hierarchical authorization dependencies by storing all necessary authorization information directly within the documents, specifically within the `VolunteerWork` documents.  The `userProfileId` within the `VolunteerWork` collection enables secure lookups of submissions related to a specific user without needing complex `get()` calls in security rules.\n\n**Structural Segregation:** User profiles are stored in a dedicated collection (`/users/{userId}`) to isolate their security requirements from other data. Volunteer work submissions are stored in a subcollection (`/users/{userId}/volunteer_work/{workId}`), ensuring all documents within this subcollection share similar access needs (owned by the user).\n\n**Access Modeling:** The structure employs path-based ownership for user profiles and volunteer work, granting the user full access to their own data. Each volunteer work submission is linked to its owner (the user) via the path.\n\n**QAPs (Rules are not Filters):** The segregation of data into user-specific subcollections enables efficient and secure `list` operations. Rules can easily filter by `request.auth.uid` to ensure a user can only access their own profiles and volunteer work submissions. The structure eliminates the need to filter based on document content, thus supporting the QAPs principle."
  }
}
